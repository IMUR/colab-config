# Smart SSH Configuration for Co-lab Cluster
# This config enables seamless access whether local or remote

# Gateway for remote access
Host gateway
    HostName YOUR_PUBLIC_IP_OR_DUCKDNS  # Replace with actual public IP or DuckDNS domain
    User crtr
    Port 22
    IdentityFile ~/.ssh/id_ed25519_automation
    IdentitiesOnly yes

# Cluster nodes with automatic jump through gateway when remote
# Use these hostnames from anywhere:

Host cluster-prtr
    HostName 192.168.254.20
    User prtr
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes
    ProxyCommand bash -c "nc -w 1 192.168.254.20 22 2>/dev/null && nc %h %p || ssh gateway -W %h:%p"

Host cluster-drtr
    HostName 192.168.254.30
    User drtr
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes
    ProxyCommand bash -c "nc -w 1 192.168.254.30 22 2>/dev/null && nc %h %p || ssh gateway -W %h:%p"

Host cluster-snitcher
    HostName 192.168.254.96
    User snitcher
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes
    ProxyCommand bash -c "nc -w 1 192.168.254.96 22 2>/dev/null && nc %h %p || ssh gateway -W %h:%p"

Host cluster-crtr
    HostName 192.168.254.10
    User crtr
    IdentityFile ~/.ssh/id_ed25519_automation
    IdentitiesOnly yes
    ProxyCommand bash -c "nc -w 1 192.168.254.10 22 2>/dev/null && nc %h %p || ssh gateway -W %h:%p"

# Note: The ProxyCommand checks if the host is directly reachable (local network)
# If not, it automatically routes through the gateway (remote access)
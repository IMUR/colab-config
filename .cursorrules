# Colab-Config Repository AI Assistant Rules

## Repository Context
Hybrid infrastructure configuration using Chezmoi (user) + Ansible (system) + Docker (services).
Safety-first approach with multiple validation gates.

## Critical Safety Rules
- NEVER delete files - archive instead
- NEVER modify system files directly
- ALWAYS run validation before changes
- ALWAYS use --check with ansible
- ALWAYS diff before chezmoi apply
- NEVER store secrets in repository

## Directory-Specific Rules

### dotfiles/
- Read .agent-context.json first
- Use Chezmoi commands only
- Template with {{ .chezmoi.hostname }}
- Validate with: chezmoi diff

### ansible/
- Check .safety-rules.yml ALWAYS
- Mandatory: --syntax-check first
- Mandatory: --check before real run
- System changes need approval

### services/
- Docker Compose only
- Validate with: docker compose config
- Use .env.template for examples
- No production secrets

### scripts/
- Must pass shellcheck
- Include help text
- Use set -euo pipefail
- Non-destructive by default

## Workflow Patterns
1. Read context files (.agent-context.json)
2. Check safety rules if present
3. Validate syntax/format
4. Run dry-run/diff
5. Get approval if needed
6. Execute with monitoring
7. Update documentation

## Validation Commands
```bash
# Dotfiles
chezmoi diff
chezmoi doctor

# Ansible
ansible-playbook --syntax-check
ansible-playbook --check

# Services
docker compose config

# Scripts
shellcheck script.sh
bash -n script.sh
```

## Escalation Triggers
- System modification → human approval
- Validation failure → provide fixes
- Safety violation → stop and explain
- Unclear request → ask for clarification

## File Patterns
- dot_* = Chezmoi dotfile templates
- *.tmpl = Template files
- *.yml = YAML configs (validate first)
- *.sh = Shell scripts (shellcheck first)

## Success Metrics
- Zero safety violations
- 95%+ validation pass rate
- All changes documented
- Rollback plan for system changes
